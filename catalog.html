<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fly Catalog - On Point Flies</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
</head>
<body>
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">On Point <span>Flies</span></a>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="catalog.html" class="active">Catalog</a></li>
                <li><a href="inventory.html">Inventory</a></li>
                <li><a href="order.html">Order</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="account.html" id="account-link">Account</a></li>
            </ul>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation"><span></span><span></span><span></span></button>
        </div>
    </nav>
    <section class="page-hero">
        <div class="hero-bg" style="background-image: url('https://images.pexels.com/photos/1089234/pexels-photo-1089234.jpeg?auto=compress&cs=tinysrgb&w=1920');"></div>
        <div class="hero-content">
            <span class="section-label">Browse Patterns</span>
            <h1>Fly Catalog</h1>
            <p>Explore our collection of hand-tied flies.</p>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <div class="search-wrap"><input type="text" id="searchInput" placeholder="Search flies..."></div>
            <div class="filter-bar">
                <button class="filter-btn active" data-filter="all">All Flies</button>
                <button class="filter-btn" data-filter="Streamer">Streamers</button>
                <button class="filter-btn" data-filter="Nymph">Nymphs</button>
                <button class="filter-btn" data-filter="Dry Fly">Dry Flies</button>
            </div>
            <div class="catalog-grid" id="catalog-grid"></div>
            <div id="empty-state" style="display:none;text-align:center;padding:3rem;"><p>No flies match your search.</p></div>
        </div>
    </section>
    <footer class="footer">
        <div class="footer-bottom"><p>&copy; 2026 On Point Flies. All rights reserved.</p></div>
    </footer>
    <div id="toast" class="toast"></div>
<script>
var AUTH0_CONFIG = {
    domain: 'dev-ofdinri72f360yav.us.auth0.com',
    clientId: 'cFJGoFKtK0pgeR16J2fmX4saKHy8I86V',
    redirectUri: window.location.origin + '/catalog.html'
};
var auth0Client = null;
var isAuthenticated = false;
var allFlies = [];
var activeFilter = 'all';

async function initAuth0() {
    try {
        auth0Client = await auth0.createAuth0Client({
            domain: AUTH0_CONFIG.domain,
            clientId: AUTH0_CONFIG.clientId,
            cacheLocation: 'localstorage',
            authorizationParams: { redirect_uri: AUTH0_CONFIG.redirectUri }
        });
        if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
            await auth0Client.handleRedirectCallback();
            window.history.replaceState({}, document.title, window.location.pathname);
        }
        isAuthenticated = await auth0Client.isAuthenticated();
        if (isAuthenticated) document.getElementById('account-link').innerHTML = '&#128100; Account';
    } catch (err) { console.error('Auth0 error:', err); }
}

function showToast(msg, type) {
    var t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast ' + (type||'success') + ' show';
    setTimeout(function(){ t.className = 'toast'; }, 3000);
}

function getFavorites() { var s = localStorage.getItem('opf_favorites'); return s ? JSON.parse(s) : []; }
function saveFavorites(f) { localStorage.setItem('opf_favorites', JSON.stringify(f)); }
function isFavorite(name) { var f = getFavorites(); for(var i=0;i<f.length;i++) if(f[i].name===name)return true; return false; }

function toggleFavorite(flyJson) {
    if (!isAuthenticated) { showToast('Please log in to save favorites','info'); setTimeout(function(){window.location.href='account.html';},1500); return; }
    var fly = JSON.parse(flyJson);
    var favs = getFavorites();
    var found = -1;
    for(var i=0;i<favs.length;i++) if(favs[i].name===fly.name){found=i;break;}
    if(found>-1){favs.splice(found,1);showToast('Removed from favorites');}
    else{favs.push(fly);showToast('Added to favorites!');}
    saveFavorites(favs);
    renderFlies(allFlies);
}

function getShoppingList() { var s = localStorage.getItem('opf_shopping_list'); return s ? JSON.parse(s) : []; }
function saveShoppingList(l) { localStorage.setItem('opf_shopping_list', JSON.stringify(l)); }

function addToList(flyJson) {
    if (!isAuthenticated) { showToast('Please log in to use shopping lists','info'); setTimeout(function(){window.location.href='account.html';},1500); return; }
    var fly = JSON.parse(flyJson);
    var list = getShoppingList();
    var found = null;
    for(var i=0;i<list.length;i++) if(list[i].name===fly.name){found=list[i];break;}
    if(found){found.quantity=(found.quantity||1)+1;showToast('Added another '+fly.name);}
    else{fly.quantity=1;fly.price=2.50;list.push(fly);showToast('Added to shopping list!');}
    saveShoppingList(list);
}

function renderFlies(flies) {
    var grid = document.getElementById('catalog-grid');
    var empty = document.getElementById('empty-state');
    var filtered = [];
    for(var i=0;i<flies.length;i++) if(activeFilter==='all'||flies[i].type===activeFilter) filtered.push(flies[i]);
    var query = document.getElementById('searchInput').value.toLowerCase();
    if(query){var s=[];for(var i=0;i<filtered.length;i++){var f=filtered[i];if(f.name.toLowerCase().indexOf(query)>-1||f.type.toLowerCase().indexOf(query)>-1||f.bestFor.toLowerCase().indexOf(query)>-1)s.push(f);}filtered=s;}
    if(filtered.length===0){grid.innerHTML='';empty.style.display='block';return;}
    empty.style.display='none';
    var html='';
    for(var i=0;i<filtered.length;i++){
        var fly=filtered[i];
        var fav=isFavorite(fly.name);
        var fd=JSON.stringify(fly).replace(/'/g,"\\'").replace(/"/g,'&quot;');
        html+='<div class="card"><div class="card-image"><img src="'+fly.image+'" alt="'+fly.name+'">';
        html+='<button class="favorite-btn '+(fav?'active':'')+'" onclick="toggleFavorite(\''+fd+'\')">'+(fav?'&#9829;':'&#9825;')+'</button></div>';
        html+='<div class="card-body"><span class="card-tag">'+fly.type+'</span><h3>'+fly.name+'</h3>';
        html+='<p><strong>Best for:</strong> '+fly.bestFor+'</p><p>'+fly.description+'</p>';
        if(fly.recipe)html+='<details style="margin-top:0.75rem;"><summary style="cursor:pointer;font-weight:600;">View Recipe</summary><pre style="margin-top:0.5rem;white-space:pre-wrap;font-size:0.8rem;">'+fly.recipe+'</pre></details>';
        html+='<button class="btn btn-sm btn-dark add-to-list-btn" onclick="addToList(\''+fd+'\')">+ Add to List</button>';
        html+='</div></div>';
    }
    grid.innerHTML=html;
}

document.addEventListener('DOMContentLoaded', function() {
    var navbar = document.getElementById('navbar');
    window.addEventListener('scroll', function() { navbar.classList.toggle('scrolled', window.scrollY > 50); });
    document.getElementById('navToggle').addEventListener('click', function() { document.getElementById('navLinks').classList.toggle('open'); });
    document.getElementById('searchInput').addEventListener('input', function() { renderFlies(allFlies); });
    var btns = document.querySelectorAll('.filter-btn');
    for(var i=0;i<btns.length;i++) btns[i].addEventListener('click', function() {
        for(var j=0;j<btns.length;j++) btns[j].classList.remove('active');
        this.classList.add('active');
        activeFilter = this.getAttribute('data-filter');
        renderFlies(allFlies);
    });
    fetch('flies.json').then(function(r){return r.json();}).then(function(flies){allFlies=flies;renderFlies(flies);initAuth0();});
});
</script>
</body>
</html>
